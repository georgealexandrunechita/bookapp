{% extends 'bookapp/layout.html' %}

{% block content %}

<h2>Listado de libros</h2>


<form method="get">
    <input type="text" name="title" value="{{ title_filter }}" placeholder="Filtrar por título">
    <input type="hidden" name="sort" value="{{ sort }}">
    <input type="hidden" name="direction" value="{{ direction }}">
    <button type="submit">Filtrar</button>
    <a href="{% url 'book_list' %}">Limpiar</a>
</form>


<table border="1">
    <thead>
        <tr>
            {% with next_dir_title=direction == 'asc' and sort == 'title'|yesno:'desc,asc' %}
            <th>
                <a href="?{{ get_params }}&sort=title&direction={% if sort == 'title' and direction == 'asc' %}desc{% else %}asc{% endif %}">
                    Title {% if sort == 'title' %}{% if direction == 'asc' %}▲{% else %}▼{% endif %}{% endif %}
                </a>
            </th>
            {% endwith %}
            <th>
                <a href="?{{ get_params }}&sort=pages&direction={% if sort == 'pages' and direction == 'asc' %}desc{% else %}asc{% endif %}">
                    Pages {% if sort == 'pages' %}{% if direction == 'asc' %}▲{% else %}▼{% endif %}{% endif %}
                </a>
            </th>
            <th>
                <a href="?{{ get_params }}&sort=rating&direction={% if sort == 'rating' and direction == 'asc' %}desc{% else %}asc{% endif %}">
                    Rating {% if sort == 'rating' %}{% if direction == 'asc' %}▲{% else %}▼{% endif %}{% endif %}
                </a>
            </th>
            <th>
                <a href="?{{ get_params }}&sort=status&direction={% if sort == 'status' and direction == 'asc' %}desc{% else %}asc{% endif %}">
                    Status {% if sort == 'status' %}{% if direction == 'asc' %}▲{% else %}▼{% endif %}{% endif %}
                </a>
            </th>
            <th>
                <a href="?{{ get_params }}&sort=published_date&direction={% if sort == 'published_date' and direction == 'asc' %}desc{% else %}asc{% endif %}">
                    Published date {% if sort == 'published_date' %}{% if direction == 'asc' %}▲{% else %}▼{% endif %}{% endif %}
                </a>
            </th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for book in books %}
        <tr>
            <td>{{ book.title }}</td>
            <td>{{ book.pages }}</td>
            <td>{{ book.rating }}</td>
            <td>{{ book.get_status_display }}</td>
            <td>{{ book.published_date }}</td>
            <td>
                {% if user.is_authenticated %}
                    <a href="{% url 'book_detail' book.pk %}">Details</a>
                {% endif %}
                {% if perms.bookapp.change_book %}
                    <a href="{% url 'book_edit' book.pk %}">Edit</a>
                {% endif %}
                {% if perms.bookapp.delete_book %}
                    <a href="{% url 'book_delete' book.pk %}">Delete</a>
                {% endif %}
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="6">No hay libros.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>


<div>
    {% if page_obj.has_previous %}
        <a href="?{{ get_params }}&page=1">« Primera</a>
        <a href="?{{ get_params }}&page={{ page_obj.previous_page_number }}">Anterior</a>
    {% endif %}

    <span>Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}</span>

    {% if page_obj.has_next %}
        <a href="?{{ get_params }}&page={{ page_obj.next_page_number }}">Siguiente</a>
        <a href="?{{ get_params }}&page={{ page_obj.paginator.num_pages }}">Última »</a>
    {% endif %}
</div>

{% if perms.bookapp.add_book %}
    <a href="{% url 'form' %}">New book</a>
{% endif %}

<a href="{% url 'book_stats' %}">Ver estadísticas</a>

{% endblock content %}
